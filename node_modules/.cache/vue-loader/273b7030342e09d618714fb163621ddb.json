{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\yeb3\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\yeb3\\src\\components\\sys\\basic\\PermissMana.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\yeb3\\src\\components\\sys\\basic\\PermissMana.vue","mtime":1669914085669},{"path":"C:\\Users\\Administrator\\Desktop\\yeb3\\node_modules\\@vue\\cli-service\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\yeb3\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\yeb3\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\yeb3\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\yeb3\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLnBlcm1pc3NNYW5hIHsNCiAgZGlzcGxheTogZmxleDsNCiAganVzdGlmeS1jb250ZW50OiBmbGV4LXN0YXJ0Ow0KfQ0KLnBlcm1pc3NNYW5hIC5lbC1pbnB1dCB7DQogIHdpZHRoOiAzMDBweDsNCiAgbWFyZ2luLXJpZ2h0OiA2cHg7DQp9DQoucGVybWlzc01hbmFNYWluIHsNCiAgbWFyZ2luLXRvcDogMTBweDsNCiAgd2lkdGg6IDcwMHB4Ow0KfQ0K"},{"version":3,"sources":["PermissMana.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PermissMana.vue","sourceRoot":"src/components/sys/basic","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"permissMana\">\r\n      <el-input size=\"small\" placeholder=\"请输入角色英文名\" v-model=\"role.name\">\r\n        <template size=\"small\" slot=\"prepend\">Role_</template>\r\n      </el-input>\r\n      <el-input\r\n        size=\"small\"\r\n        placeholder=\"请输入角色中文名\"\r\n        v-model=\"role.nameZh\"\r\n        @keydown.enter.native=\"doAddRole\"\r\n      >\r\n      </el-input>\r\n      <el-button size=\"small\" type=\"primary\" @click=\"doAddRole\"\r\n        >添加角色</el-button\r\n      >\r\n    </div>\r\n    <div class=\"permissManaMain\">\r\n      <el-collapse v-model=\"activeName\" accordion @change=\"change\">\r\n        <el-collapse-item\r\n          :title=\"r.nameZh\"\r\n          :name=\"r.id\"\r\n          v-for=\"(r, index) in roles\"\r\n          :key=\"index\"\r\n        >\r\n          <el-card class=\"box-card\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n              <span>可访问资源</span>\r\n              <el-button\r\n                style=\"float: right; padding: 3px 0; color: #ff0000\"\r\n                icon=\"el-icon-delete\"\r\n                type=\"text\"\r\n                @click=\"doDeleteRole(r)\"\r\n              ></el-button>\r\n            </div>\r\n            <div>\r\n              <el-tree\r\n                show-checkbox\r\n                ref=\"tree\"\r\n                :data=\"allMenus\"\r\n                :props=\"defaultProps\"\r\n                :default-checked-keys=\"selectedMenus\"\r\n                :key=\"index\"\r\n                node-key=\"id\"\r\n              ></el-tree>\r\n              <div style=\"display: flex; justify-content: flex-end\">\r\n                <el-button size=\"mini\" @click=\"cancelUpdate\"\r\n                  >取消修改</el-button\r\n                >\r\n                <el-button\r\n                  size=\"mini\"\r\n                  type=\"primary\"\r\n                  @click=\"doUpdate(r.id, index)\"\r\n                  >确认修改</el-button\r\n                >\r\n              </div>\r\n            </div>\r\n          </el-card>\r\n        </el-collapse-item>\r\n      </el-collapse>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"PermissMana\",\r\n  data() {\r\n    return {\r\n      role: {\r\n        name: \"\",\r\n        nameZh: \"\",\r\n      },\r\n      roles: [],\r\n      allMenus: [],\r\n      defaultProps: {\r\n        children: \"children\",\r\n        label: \"name\",\r\n      },\r\n      selectedMenus: [],\r\n      activeName: -1,\r\n    };\r\n  },\r\n  mounted() {\r\n    this.initRoles();\r\n  },\r\n  methods: {\r\n    doDeleteRole(role) {\r\n      this.$confirm(\"删除[\" + role.nameZh + \"]角色, 是否继续?\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      }).then(() => {\r\n          this.deleteRequest(\"/system/basic/permission/delete?id=\"+role.id).then((res) => {\r\n            if (res) {\r\n              this.initRoles();\r\n            }\r\n          });\r\n        }).catch(() => {\r\n          this.$message({\r\n            type: \"info\",\r\n            message: \"已取消删除\",\r\n          });\r\n        });\r\n    },\r\n    doAddRole() {\r\n      if (this.role.name && this.role.nameZh) {\r\n        this.postRequest(\"/system/basic/permission/add\", this.role).then(\r\n          (resp) => {\r\n            if (resp) {\r\n              this.initRoles();\r\n              this.role.name = \"\";\r\n              this.role.nameZh = \"\";\r\n            }\r\n          }\r\n        );\r\n      } else {\r\n        this.$message.error(\"所有字段不能为空!\");\r\n      }\r\n    },\r\n    cancelUpdate() {\r\n      this.activeName = -1;\r\n    },\r\n    doUpdate(rid, index) {\r\n      let tree = this.$refs.tree[index];\r\n      let selectedKeys = tree.getCheckedKeys(true);\r\n      let url = \"/system/basic/permission/updatemenus/?rid=\" + rid;\r\n      selectedKeys.forEach((key) => {\r\n        url += \"&mids=\" + key;\r\n      });\r\n      this.putRequest(url).then((resp) => {\r\n        if (resp) {\r\n          this.initRoles();\r\n          this.activeName = -1;\r\n        }\r\n      });\r\n    },\r\n    change(rid) {\r\n      if (rid) {\r\n        this.selectedMenus = [];\r\n        this.initAllMenus();\r\n        this.initSelectedMenus(rid);\r\n      }\r\n    },\r\n    initSelectedMenus(rid) {\r\n      let url = \"/system/basic/permission/mid/?rid=\" + rid;\r\n      this.getRequest(url).then((resp) => {\r\n        console.log(resp);\r\n        this.selectedMenus = resp;\r\n      });\r\n    },\r\n    initAllMenus() {\r\n      this.getRequest(\"/system/basic/permission/menus\").then((resp) => {\r\n        if (resp) {\r\n          this.allMenus = resp;\r\n        }\r\n      });\r\n    },\r\n    initRoles() {\r\n      this.getRequest(\"/system/basic/permission/list\").then((resp) => {\r\n        if (resp) {\r\n          this.roles = resp;\r\n        }\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.permissMana {\r\n  display: flex;\r\n  justify-content: flex-start;\r\n}\r\n.permissMana .el-input {\r\n  width: 300px;\r\n  margin-right: 6px;\r\n}\r\n.permissManaMain {\r\n  margin-top: 10px;\r\n  width: 700px;\r\n}\r\n</style>"]}]}