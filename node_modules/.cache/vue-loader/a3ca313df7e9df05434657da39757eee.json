{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\yeb3\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\yeb3\\src\\components\\sys\\basic\\PermissMana.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\yeb3\\src\\components\\sys\\basic\\PermissMana.vue","mtime":1670158060377},{"path":"C:\\Users\\Administrator\\Desktop\\yeb3\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\yeb3\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Administrator\\Desktop\\yeb3\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\yeb3\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJQZXJtaXNzTWFuYSIsDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHJvbGU6IHsNCiAgICAgICAgbmFtZTogIiIsDQogICAgICAgIG5hbWVaaDogIiINCiAgICAgIH0sDQogICAgICByb2xlczogW10sDQogICAgICBhbGxNZW51czogW10sDQogICAgICBkZWZhdWx0UHJvcHM6IHtjaGlsZHJlbjogImNoaWxkcmVuIiwgbGFiZWw6ICJuYW1lIn0sDQogICAgICBzZWxlY3RlZE1lbnVzOiBbXSwNCiAgICAgIGFjdGl2ZU5hbWU6IC0xDQogICAgfTsNCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICB0aGlzLmluaXRSb2xlcygpOw0KICB9LA0KICBtZXRob2RzOiB7DQoNCiAgICBkb0RlbGV0ZVJvbGUocm9sZSkgew0KICAgICAgdGhpcy4kY29uZmlybSgi5Yig6ZmkWyIgKyByb2xlLm5hbWVaaCArICJd6KeS6ImyLCDmmK/lkKbnu6fnu60/IiwgIuaPkOekuiIsDQogICAgICAgICAge2NvbmZpcm1CdXR0b25UZXh0OiAi56Gu5a6aIiwgY2FuY2VsQnV0dG9uVGV4dDogIuWPlua2iCIsIHR5cGU6ICJ3YXJuaW5nIn0NCiAgICAgICkudGhlbigoKSA9PiB7DQogICAgICAgIHRoaXMuZGVsZXRlUmVxdWVzdCgiL3N5c3RlbS9iYXNpYy9wZXJtaXNzaW9uL2RlbGV0ZT9pZD0iICsgcm9sZS5pZCkudGhlbigocmVzKSA9PiB7DQogICAgICAgICAgaWYgKHJlcykgew0KICAgICAgICAgICAgdGhpcy5pbml0Um9sZXMoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgfSkuY2F0Y2goKCkgPT4gew0KICAgICAgICB0aGlzLiRtZXNzYWdlKHt0eXBlOiAiaW5mbyIsIG1lc3NhZ2U6ICLlt7Llj5bmtojliKDpmaQifSk7DQogICAgICB9KTsNCiAgICB9LA0KDQogICAgZG9BZGRSb2xlKCkgew0KICAgICAgaWYgKHRoaXMucm9sZS5uYW1lICYmIHRoaXMucm9sZS5uYW1lWmgpIHsNCiAgICAgICAgdGhpcy5wb3N0UmVxdWVzdCgiL3N5c3RlbS9iYXNpYy9wZXJtaXNzaW9uL2FkZCIsIHRoaXMucm9sZSkudGhlbigNCiAgICAgICAgICAgIChyZXNwKSA9PiB7DQogICAgICAgICAgICAgIGlmIChyZXNwKSB7DQogICAgICAgICAgICAgICAgdGhpcy5pbml0Um9sZXMoKTsNCiAgICAgICAgICAgICAgICB0aGlzLnJvbGUubmFtZSA9ICIiOw0KICAgICAgICAgICAgICAgIHRoaXMucm9sZS5uYW1lWmggPSAiIjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICApOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5omA5pyJ5a2X5q615LiN6IO95Li656m6ISIpOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICBjYW5jZWxVcGRhdGUoKSB7DQogICAgICB0aGlzLmFjdGl2ZU5hbWUgPSAtMTsNCiAgICB9LA0KDQogICAgZG9VcGRhdGUocmlkLCBpbmRleCkgew0KICAgICAgbGV0IHRyZWUgPSB0aGlzLiRyZWZzLnRyZWVbaW5kZXhdOw0KICAgICAgbGV0IHNlbGVjdGVkS2V5cyA9IHRyZWUuZ2V0Q2hlY2tlZEtleXModHJ1ZSk7DQogICAgICBsZXQgdXJsID0gIi9zeXN0ZW0vYmFzaWMvcGVybWlzc2lvbi91cGRhdGVtZW51cy8/cmlkPSIgKyByaWQ7DQogICAgICBzZWxlY3RlZEtleXMuZm9yRWFjaCgoa2V5KSA9PiB7DQogICAgICAgIHVybCArPSAiJm1pZHM9IiArIGtleTsNCiAgICAgIH0pOw0KICAgICAgdGhpcy5wdXRSZXF1ZXN0KHVybCkudGhlbigocmVzcCkgPT4gew0KICAgICAgICBpZiAocmVzcCkgew0KICAgICAgICAgIHRoaXMuaW5pdFJvbGVzKCk7DQogICAgICAgICAgdGhpcy5hY3RpdmVOYW1lID0gLTE7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0sDQoNCiAgICBjaGFuZ2UocmlkKSB7DQogICAgICBpZiAocmlkKSB7DQogICAgICAgIHRoaXMuc2VsZWN0ZWRNZW51cyA9IFtdOw0KICAgICAgICB0aGlzLmluaXRBbGxNZW51cygpOw0KICAgICAgICB0aGlzLmluaXRTZWxlY3RlZE1lbnVzKHJpZCk7DQogICAgICB9DQogICAgfSwNCg0KICAgIGluaXRTZWxlY3RlZE1lbnVzKHJpZCkgew0KICAgICAgbGV0IHVybCA9ICIvc3lzdGVtL2Jhc2ljL3Blcm1pc3Npb24vbWlkLz9yaWQ9IiArIHJpZDsNCiAgICAgIHRoaXMuZ2V0UmVxdWVzdCh1cmwpLnRoZW4oKHJlc3ApID0+IHsNCiAgICAgICAgY29uc29sZS5sb2cocmVzcCk7DQogICAgICAgIHRoaXMuc2VsZWN0ZWRNZW51cyA9IHJlc3A7DQogICAgICB9KTsNCiAgICB9LA0KDQogICAgaW5pdEFsbE1lbnVzKCkgew0KICAgICAgdGhpcy5nZXRSZXF1ZXN0KCIvc3lzdGVtL2Jhc2ljL3Blcm1pc3Npb24vbWVudXMiKS50aGVuKChyZXNwKSA9PiB7DQogICAgICAgIGlmIChyZXNwKSB7DQogICAgICAgICAgdGhpcy5hbGxNZW51cyA9IHJlc3A7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0sDQoNCiAgICBpbml0Um9sZXMoKSB7DQogICAgICB0aGlzLmdldFJlcXVlc3QoIi9zeXN0ZW0vYmFzaWMvcGVybWlzc2lvbi9saXN0IikudGhlbigocmVzcCkgPT4gew0KICAgICAgICBpZiAocmVzcCkgew0KICAgICAgICAgIHRoaXMucm9sZXMgPSByZXNwOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9DQoNCiAgfQ0KfTsNCg=="},{"version":3,"sources":["PermissMana.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"PermissMana.vue","sourceRoot":"src/components/sys/basic","sourcesContent":["<template>\r\n  <div>\r\n\r\n    <div class=\"permissMana\">\r\n\r\n      <el-input size=\"small\" placeholder=\"请输入角色英文名\" v-model=\"role.name\">\r\n        <template size=\"small\" slot=\"prepend\">Role_</template>\r\n      </el-input>\r\n\r\n      <el-input size=\"small\" placeholder=\"请输入角色中文名\" v-model=\"role.nameZh\"\r\n                @keydown.enter.native=\"doAddRole\">\r\n      </el-input>\r\n\r\n      <el-button size=\"small\" type=\"primary\" @click=\"doAddRole\">添加角色</el-button>\r\n\r\n    </div>\r\n\r\n    <div class=\"permissManaMain\">\r\n\r\n      <el-collapse v-model=\"activeName\" accordion @change=\"change\">\r\n        <el-collapse-item\r\n            :title=\"r.nameZh\"\r\n            :name=\"r.id\"\r\n            v-for=\"(r, index) in roles\"\r\n            :key=\"index\">\r\n\r\n          <el-card class=\"box-card\">\r\n\r\n            <div slot=\"header\" class=\"clearfix\">\r\n              <span>可访问资源</span>\r\n              <el-button style=\"float: right; padding: 3px 0; color: #ff0000\" icon=\"el-icon-delete\"\r\n                         type=\"text\" @click=\"doDeleteRole(r)\">\r\n              </el-button>\r\n            </div>\r\n\r\n            <div>\r\n              <el-tree\r\n                  show-checkbox\r\n                  ref=\"tree\"\r\n                  :data=\"allMenus\"\r\n                  :props=\"defaultProps\"\r\n                  :default-checked-keys=\"selectedMenus\"\r\n                  :key=\"index\"\r\n                  node-key=\"id\">\r\n              </el-tree>\r\n\r\n              <div style=\"display: flex; justify-content: flex-end\">\r\n                <el-button size=\"mini\" @click=\"cancelUpdate\">取消修改</el-button>\r\n                <el-button size=\"mini\" type=\"primary\" @click=\"doUpdate(r.id, index)\">确认修改</el-button>\r\n              </div>\r\n\r\n            </div>\r\n\r\n          </el-card>\r\n        </el-collapse-item>\r\n\r\n      </el-collapse>\r\n    </div>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"PermissMana\",\r\n  data() {\r\n    return {\r\n      role: {\r\n        name: \"\",\r\n        nameZh: \"\"\r\n      },\r\n      roles: [],\r\n      allMenus: [],\r\n      defaultProps: {children: \"children\", label: \"name\"},\r\n      selectedMenus: [],\r\n      activeName: -1\r\n    };\r\n  },\r\n  mounted() {\r\n    this.initRoles();\r\n  },\r\n  methods: {\r\n\r\n    doDeleteRole(role) {\r\n      this.$confirm(\"删除[\" + role.nameZh + \"]角色, 是否继续?\", \"提示\",\r\n          {confirmButtonText: \"确定\", cancelButtonText: \"取消\", type: \"warning\"}\r\n      ).then(() => {\r\n        this.deleteRequest(\"/system/basic/permission/delete?id=\" + role.id).then((res) => {\r\n          if (res) {\r\n            this.initRoles();\r\n          }\r\n        });\r\n      }).catch(() => {\r\n        this.$message({type: \"info\", message: \"已取消删除\"});\r\n      });\r\n    },\r\n\r\n    doAddRole() {\r\n      if (this.role.name && this.role.nameZh) {\r\n        this.postRequest(\"/system/basic/permission/add\", this.role).then(\r\n            (resp) => {\r\n              if (resp) {\r\n                this.initRoles();\r\n                this.role.name = \"\";\r\n                this.role.nameZh = \"\";\r\n              }\r\n            }\r\n        );\r\n      } else {\r\n        this.$message.error(\"所有字段不能为空!\");\r\n      }\r\n    },\r\n\r\n    cancelUpdate() {\r\n      this.activeName = -1;\r\n    },\r\n\r\n    doUpdate(rid, index) {\r\n      let tree = this.$refs.tree[index];\r\n      let selectedKeys = tree.getCheckedKeys(true);\r\n      let url = \"/system/basic/permission/updatemenus/?rid=\" + rid;\r\n      selectedKeys.forEach((key) => {\r\n        url += \"&mids=\" + key;\r\n      });\r\n      this.putRequest(url).then((resp) => {\r\n        if (resp) {\r\n          this.initRoles();\r\n          this.activeName = -1;\r\n        }\r\n      });\r\n    },\r\n\r\n    change(rid) {\r\n      if (rid) {\r\n        this.selectedMenus = [];\r\n        this.initAllMenus();\r\n        this.initSelectedMenus(rid);\r\n      }\r\n    },\r\n\r\n    initSelectedMenus(rid) {\r\n      let url = \"/system/basic/permission/mid/?rid=\" + rid;\r\n      this.getRequest(url).then((resp) => {\r\n        console.log(resp);\r\n        this.selectedMenus = resp;\r\n      });\r\n    },\r\n\r\n    initAllMenus() {\r\n      this.getRequest(\"/system/basic/permission/menus\").then((resp) => {\r\n        if (resp) {\r\n          this.allMenus = resp;\r\n        }\r\n      });\r\n    },\r\n\r\n    initRoles() {\r\n      this.getRequest(\"/system/basic/permission/list\").then((resp) => {\r\n        if (resp) {\r\n          this.roles = resp;\r\n        }\r\n      });\r\n    }\r\n\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n.permissMana {\r\n  display: flex;\r\n  justify-content: flex-start;\r\n}\r\n\r\n.permissMana .el-input {\r\n  width: 300px;\r\n  margin-right: 6px;\r\n}\r\n\r\n.permissManaMain {\r\n  margin-top: 10px;\r\n  width: 700px;\r\n}\r\n</style>"]}]}