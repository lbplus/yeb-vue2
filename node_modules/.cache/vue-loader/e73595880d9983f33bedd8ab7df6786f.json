{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\yeb2\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\yeb2\\src\\components\\sys\\basic\\PermissMana.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\yeb2\\src\\components\\sys\\basic\\PermissMana.vue","mtime":1669914085669},{"path":"C:\\Users\\Administrator\\Desktop\\yeb2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\yeb2\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Administrator\\Desktop\\yeb2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\yeb2\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJQZXJtaXNzTWFuYSIsDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHJvbGU6IHsNCiAgICAgICAgbmFtZTogIiIsDQogICAgICAgIG5hbWVaaDogIiIsDQogICAgICB9LA0KICAgICAgcm9sZXM6IFtdLA0KICAgICAgYWxsTWVudXM6IFtdLA0KICAgICAgZGVmYXVsdFByb3BzOiB7DQogICAgICAgIGNoaWxkcmVuOiAiY2hpbGRyZW4iLA0KICAgICAgICBsYWJlbDogIm5hbWUiLA0KICAgICAgfSwNCiAgICAgIHNlbGVjdGVkTWVudXM6IFtdLA0KICAgICAgYWN0aXZlTmFtZTogLTEsDQogICAgfTsNCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICB0aGlzLmluaXRSb2xlcygpOw0KICB9LA0KICBtZXRob2RzOiB7DQogICAgZG9EZWxldGVSb2xlKHJvbGUpIHsNCiAgICAgIHRoaXMuJGNvbmZpcm0oIuWIoOmZpFsiICsgcm9sZS5uYW1lWmggKyAiXeinkuiJsiwg5piv5ZCm57un57utPyIsICLmj5DnpLoiLCB7DQogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAi56Gu5a6aIiwNCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogIuWPlua2iCIsDQogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwNCiAgICAgIH0pLnRoZW4oKCkgPT4gew0KICAgICAgICAgIHRoaXMuZGVsZXRlUmVxdWVzdCgiL3N5c3RlbS9iYXNpYy9wZXJtaXNzaW9uL2RlbGV0ZT9pZD0iK3JvbGUuaWQpLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgICAgaWYgKHJlcykgew0KICAgICAgICAgICAgICB0aGlzLmluaXRSb2xlcygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9KS5jYXRjaCgoKSA9PiB7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZSh7DQogICAgICAgICAgICB0eXBlOiAiaW5mbyIsDQogICAgICAgICAgICBtZXNzYWdlOiAi5bey5Y+W5raI5Yig6ZmkIiwNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgfSwNCiAgICBkb0FkZFJvbGUoKSB7DQogICAgICBpZiAodGhpcy5yb2xlLm5hbWUgJiYgdGhpcy5yb2xlLm5hbWVaaCkgew0KICAgICAgICB0aGlzLnBvc3RSZXF1ZXN0KCIvc3lzdGVtL2Jhc2ljL3Blcm1pc3Npb24vYWRkIiwgdGhpcy5yb2xlKS50aGVuKA0KICAgICAgICAgIChyZXNwKSA9PiB7DQogICAgICAgICAgICBpZiAocmVzcCkgew0KICAgICAgICAgICAgICB0aGlzLmluaXRSb2xlcygpOw0KICAgICAgICAgICAgICB0aGlzLnJvbGUubmFtZSA9ICIiOw0KICAgICAgICAgICAgICB0aGlzLnJvbGUubmFtZVpoID0gIiI7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICApOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5omA5pyJ5a2X5q615LiN6IO95Li656m6ISIpOw0KICAgICAgfQ0KICAgIH0sDQogICAgY2FuY2VsVXBkYXRlKCkgew0KICAgICAgdGhpcy5hY3RpdmVOYW1lID0gLTE7DQogICAgfSwNCiAgICBkb1VwZGF0ZShyaWQsIGluZGV4KSB7DQogICAgICBsZXQgdHJlZSA9IHRoaXMuJHJlZnMudHJlZVtpbmRleF07DQogICAgICBsZXQgc2VsZWN0ZWRLZXlzID0gdHJlZS5nZXRDaGVja2VkS2V5cyh0cnVlKTsNCiAgICAgIGxldCB1cmwgPSAiL3N5c3RlbS9iYXNpYy9wZXJtaXNzaW9uL3VwZGF0ZW1lbnVzLz9yaWQ9IiArIHJpZDsNCiAgICAgIHNlbGVjdGVkS2V5cy5mb3JFYWNoKChrZXkpID0+IHsNCiAgICAgICAgdXJsICs9ICImbWlkcz0iICsga2V5Ow0KICAgICAgfSk7DQogICAgICB0aGlzLnB1dFJlcXVlc3QodXJsKS50aGVuKChyZXNwKSA9PiB7DQogICAgICAgIGlmIChyZXNwKSB7DQogICAgICAgICAgdGhpcy5pbml0Um9sZXMoKTsNCiAgICAgICAgICB0aGlzLmFjdGl2ZU5hbWUgPSAtMTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSwNCiAgICBjaGFuZ2UocmlkKSB7DQogICAgICBpZiAocmlkKSB7DQogICAgICAgIHRoaXMuc2VsZWN0ZWRNZW51cyA9IFtdOw0KICAgICAgICB0aGlzLmluaXRBbGxNZW51cygpOw0KICAgICAgICB0aGlzLmluaXRTZWxlY3RlZE1lbnVzKHJpZCk7DQogICAgICB9DQogICAgfSwNCiAgICBpbml0U2VsZWN0ZWRNZW51cyhyaWQpIHsNCiAgICAgIGxldCB1cmwgPSAiL3N5c3RlbS9iYXNpYy9wZXJtaXNzaW9uL21pZC8/cmlkPSIgKyByaWQ7DQogICAgICB0aGlzLmdldFJlcXVlc3QodXJsKS50aGVuKChyZXNwKSA9PiB7DQogICAgICAgIGNvbnNvbGUubG9nKHJlc3ApOw0KICAgICAgICB0aGlzLnNlbGVjdGVkTWVudXMgPSByZXNwOw0KICAgICAgfSk7DQogICAgfSwNCiAgICBpbml0QWxsTWVudXMoKSB7DQogICAgICB0aGlzLmdldFJlcXVlc3QoIi9zeXN0ZW0vYmFzaWMvcGVybWlzc2lvbi9tZW51cyIpLnRoZW4oKHJlc3ApID0+IHsNCiAgICAgICAgaWYgKHJlc3ApIHsNCiAgICAgICAgICB0aGlzLmFsbE1lbnVzID0gcmVzcDsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSwNCiAgICBpbml0Um9sZXMoKSB7DQogICAgICB0aGlzLmdldFJlcXVlc3QoIi9zeXN0ZW0vYmFzaWMvcGVybWlzc2lvbi9saXN0IikudGhlbigocmVzcCkgPT4gew0KICAgICAgICBpZiAocmVzcCkgew0KICAgICAgICAgIHRoaXMucm9sZXMgPSByZXNwOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9LA0KICB9LA0KfTsNCg=="},{"version":3,"sources":["PermissMana.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PermissMana.vue","sourceRoot":"src/components/sys/basic","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"permissMana\">\r\n      <el-input size=\"small\" placeholder=\"请输入角色英文名\" v-model=\"role.name\">\r\n        <template size=\"small\" slot=\"prepend\">Role_</template>\r\n      </el-input>\r\n      <el-input\r\n        size=\"small\"\r\n        placeholder=\"请输入角色中文名\"\r\n        v-model=\"role.nameZh\"\r\n        @keydown.enter.native=\"doAddRole\"\r\n      >\r\n      </el-input>\r\n      <el-button size=\"small\" type=\"primary\" @click=\"doAddRole\"\r\n        >添加角色</el-button\r\n      >\r\n    </div>\r\n    <div class=\"permissManaMain\">\r\n      <el-collapse v-model=\"activeName\" accordion @change=\"change\">\r\n        <el-collapse-item\r\n          :title=\"r.nameZh\"\r\n          :name=\"r.id\"\r\n          v-for=\"(r, index) in roles\"\r\n          :key=\"index\"\r\n        >\r\n          <el-card class=\"box-card\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n              <span>可访问资源</span>\r\n              <el-button\r\n                style=\"float: right; padding: 3px 0; color: #ff0000\"\r\n                icon=\"el-icon-delete\"\r\n                type=\"text\"\r\n                @click=\"doDeleteRole(r)\"\r\n              ></el-button>\r\n            </div>\r\n            <div>\r\n              <el-tree\r\n                show-checkbox\r\n                ref=\"tree\"\r\n                :data=\"allMenus\"\r\n                :props=\"defaultProps\"\r\n                :default-checked-keys=\"selectedMenus\"\r\n                :key=\"index\"\r\n                node-key=\"id\"\r\n              ></el-tree>\r\n              <div style=\"display: flex; justify-content: flex-end\">\r\n                <el-button size=\"mini\" @click=\"cancelUpdate\"\r\n                  >取消修改</el-button\r\n                >\r\n                <el-button\r\n                  size=\"mini\"\r\n                  type=\"primary\"\r\n                  @click=\"doUpdate(r.id, index)\"\r\n                  >确认修改</el-button\r\n                >\r\n              </div>\r\n            </div>\r\n          </el-card>\r\n        </el-collapse-item>\r\n      </el-collapse>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"PermissMana\",\r\n  data() {\r\n    return {\r\n      role: {\r\n        name: \"\",\r\n        nameZh: \"\",\r\n      },\r\n      roles: [],\r\n      allMenus: [],\r\n      defaultProps: {\r\n        children: \"children\",\r\n        label: \"name\",\r\n      },\r\n      selectedMenus: [],\r\n      activeName: -1,\r\n    };\r\n  },\r\n  mounted() {\r\n    this.initRoles();\r\n  },\r\n  methods: {\r\n    doDeleteRole(role) {\r\n      this.$confirm(\"删除[\" + role.nameZh + \"]角色, 是否继续?\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      }).then(() => {\r\n          this.deleteRequest(\"/system/basic/permission/delete?id=\"+role.id).then((res) => {\r\n            if (res) {\r\n              this.initRoles();\r\n            }\r\n          });\r\n        }).catch(() => {\r\n          this.$message({\r\n            type: \"info\",\r\n            message: \"已取消删除\",\r\n          });\r\n        });\r\n    },\r\n    doAddRole() {\r\n      if (this.role.name && this.role.nameZh) {\r\n        this.postRequest(\"/system/basic/permission/add\", this.role).then(\r\n          (resp) => {\r\n            if (resp) {\r\n              this.initRoles();\r\n              this.role.name = \"\";\r\n              this.role.nameZh = \"\";\r\n            }\r\n          }\r\n        );\r\n      } else {\r\n        this.$message.error(\"所有字段不能为空!\");\r\n      }\r\n    },\r\n    cancelUpdate() {\r\n      this.activeName = -1;\r\n    },\r\n    doUpdate(rid, index) {\r\n      let tree = this.$refs.tree[index];\r\n      let selectedKeys = tree.getCheckedKeys(true);\r\n      let url = \"/system/basic/permission/updatemenus/?rid=\" + rid;\r\n      selectedKeys.forEach((key) => {\r\n        url += \"&mids=\" + key;\r\n      });\r\n      this.putRequest(url).then((resp) => {\r\n        if (resp) {\r\n          this.initRoles();\r\n          this.activeName = -1;\r\n        }\r\n      });\r\n    },\r\n    change(rid) {\r\n      if (rid) {\r\n        this.selectedMenus = [];\r\n        this.initAllMenus();\r\n        this.initSelectedMenus(rid);\r\n      }\r\n    },\r\n    initSelectedMenus(rid) {\r\n      let url = \"/system/basic/permission/mid/?rid=\" + rid;\r\n      this.getRequest(url).then((resp) => {\r\n        console.log(resp);\r\n        this.selectedMenus = resp;\r\n      });\r\n    },\r\n    initAllMenus() {\r\n      this.getRequest(\"/system/basic/permission/menus\").then((resp) => {\r\n        if (resp) {\r\n          this.allMenus = resp;\r\n        }\r\n      });\r\n    },\r\n    initRoles() {\r\n      this.getRequest(\"/system/basic/permission/list\").then((resp) => {\r\n        if (resp) {\r\n          this.roles = resp;\r\n        }\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.permissMana {\r\n  display: flex;\r\n  justify-content: flex-start;\r\n}\r\n.permissMana .el-input {\r\n  width: 300px;\r\n  margin-right: 6px;\r\n}\r\n.permissManaMain {\r\n  margin-top: 10px;\r\n  width: 700px;\r\n}\r\n</style>"]}]}