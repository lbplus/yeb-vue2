{"remainingRequest":"C:\\Users\\Dongeast\\Desktop\\Java项目\\yeb前端项目\\yeb前端二\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Dongeast\\Desktop\\Java项目\\yeb前端项目\\yeb前端二\\src\\components\\sys\\basic\\PermissMana.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Dongeast\\Desktop\\Java项目\\yeb前端项目\\yeb前端二\\src\\components\\sys\\basic\\PermissMana.vue","mtime":1636459923062},{"path":"C:\\Users\\Dongeast\\Desktop\\Java项目\\yeb前端项目\\yeb前端二\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Dongeast\\Desktop\\Java项目\\yeb前端项目\\yeb前端二\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Dongeast\\Desktop\\Java项目\\yeb前端项目\\yeb前端二\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Dongeast\\Desktop\\Java项目\\yeb前端项目\\yeb前端二\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJQZXJtaXNzTWFuYSIsDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHJvbGU6IHsNCiAgICAgICAgbmFtZTogIiIsDQogICAgICAgIG5hbWVaaDogIiIsDQogICAgICB9LA0KICAgICAgcm9sZXM6IFtdLA0KICAgICAgYWxsTWVudXM6IFtdLA0KICAgICAgZGVmYXVsdFByb3BzOiB7DQogICAgICAgIGNoaWxkcmVuOiAiY2hpbGRyZW4iLA0KICAgICAgICBsYWJlbDogIm5hbWUiLA0KICAgICAgfSwNCiAgICAgIHNlbGVjdGVkTWVudXM6IFtdLA0KICAgICAgYWN0aXZlTmFtZTogLTEsDQogICAgfTsNCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICB0aGlzLmluaXRSb2xlcygpOw0KICB9LA0KICBtZXRob2RzOiB7DQogICAgZG9EZWxldGVSb2xlKHJvbGUpIHsNCiAgICAgIHRoaXMuJGNvbmZpcm0oIuWIoOmZpFsiICsgcm9sZS5uYW1lWmggKyAiXeinkuiJsiwg5piv5ZCm57un57utPyIsICLmj5DnpLoiLCB7DQogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAi56Gu5a6aIiwNCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogIuWPlua2iCIsDQogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwNCiAgICAgIH0pDQogICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICB0aGlzLmRlbGV0ZVJlcXVlc3QoIi9zeXN0ZW0vYmFzaWMvcGVybWlzc2lvbi9kZWxldGUiLCB7DQogICAgICAgICAgICBpZDogcm9sZS5pZCwNCiAgICAgICAgICB9KS50aGVuKChyZXMpID0+IHsNCiAgICAgICAgICAgIGlmIChyZXMpIHsNCiAgICAgICAgICAgICAgdGhpcy5pbml0Um9sZXMoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKCgpID0+IHsNCiAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsNCiAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwNCiAgICAgICAgICAgIG1lc3NhZ2U6ICLlt7Llj5bmtojliKDpmaQiLA0KICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICB9LA0KICAgIGRvQWRkUm9sZSgpIHsNCiAgICAgIGlmICh0aGlzLnJvbGUubmFtZSAmJiB0aGlzLnJvbGUubmFtZVpoKSB7DQogICAgICAgIHRoaXMucG9zdFJlcXVlc3QoIi9zeXN0ZW0vYmFzaWMvcGVybWlzc2lvbi9hZGQiLCB0aGlzLnJvbGUpLnRoZW4oDQogICAgICAgICAgKHJlc3ApID0+IHsNCiAgICAgICAgICAgIGlmIChyZXNwKSB7DQogICAgICAgICAgICAgIHRoaXMuaW5pdFJvbGVzKCk7DQogICAgICAgICAgICAgIHRoaXMucm9sZS5uYW1lID0gIiI7DQogICAgICAgICAgICAgIHRoaXMucm9sZS5uYW1lWmggPSAiIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLmiYDmnInlrZfmrrXkuI3og73kuLrnqbohIik7DQogICAgICB9DQogICAgfSwNCiAgICBjYW5jZWxVcGRhdGUoKSB7DQogICAgICB0aGlzLmFjdGl2ZU5hbWUgPSAtMTsNCiAgICB9LA0KICAgIGRvVXBkYXRlKHJpZCwgaW5kZXgpIHsNCiAgICAgIGxldCB0cmVlID0gdGhpcy4kcmVmcy50cmVlW2luZGV4XTsNCiAgICAgIGxldCBzZWxlY3RlZEtleXMgPSB0cmVlLmdldENoZWNrZWRLZXlzKHRydWUpOw0KICAgICAgbGV0IHVybCA9ICIvc3lzdGVtL2Jhc2ljL3Blcm1pc3Npb24vdXBkYXRlbWVudXMvP3JpZD0iICsgcmlkOw0KICAgICAgc2VsZWN0ZWRLZXlzLmZvckVhY2goKGtleSkgPT4gew0KICAgICAgICB1cmwgKz0gIiZtaWRzPSIgKyBrZXk7DQogICAgICB9KTsNCiAgICAgIHRoaXMucHV0UmVxdWVzdCh1cmwpLnRoZW4oKHJlc3ApID0+IHsNCiAgICAgICAgaWYgKHJlc3ApIHsNCiAgICAgICAgICB0aGlzLmluaXRSb2xlcygpOw0KICAgICAgICAgIHRoaXMuYWN0aXZlTmFtZSA9IC0xOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9LA0KICAgIGNoYW5nZShyaWQpIHsNCiAgICAgIGlmIChyaWQpIHsNCiAgICAgICAgdGhpcy5zZWxlY3RlZE1lbnVzID0gW107DQogICAgICAgIHRoaXMuaW5pdEFsbE1lbnVzKCk7DQogICAgICAgIHRoaXMuaW5pdFNlbGVjdGVkTWVudXMocmlkKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGluaXRTZWxlY3RlZE1lbnVzKHJpZCkgew0KICAgICAgbGV0IHVybCA9ICIvc3lzdGVtL2Jhc2ljL3Blcm1pc3Npb24vbWlkLz9yaWQ9IiArIHJpZDsNCiAgICAgIHRoaXMuZ2V0UmVxdWVzdCh1cmwpLnRoZW4oKHJlc3ApID0+IHsNCiAgICAgICAgY29uc29sZS5sb2cocmVzcCk7DQogICAgICAgIHRoaXMuc2VsZWN0ZWRNZW51cyA9IHJlc3A7DQogICAgICB9KTsNCiAgICB9LA0KICAgIGluaXRBbGxNZW51cygpIHsNCiAgICAgIHRoaXMuZ2V0UmVxdWVzdCgiL3N5c3RlbS9iYXNpYy9wZXJtaXNzaW9uL21lbnVzIikudGhlbigocmVzcCkgPT4gew0KICAgICAgICBpZiAocmVzcCkgew0KICAgICAgICAgIHRoaXMuYWxsTWVudXMgPSByZXNwOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9LA0KICAgIGluaXRSb2xlcygpIHsNCiAgICAgIHRoaXMuZ2V0UmVxdWVzdCgiL3N5c3RlbS9iYXNpYy9wZXJtaXNzaW9uL2xpc3QiKS50aGVuKChyZXNwKSA9PiB7DQogICAgICAgIGlmIChyZXNwKSB7DQogICAgICAgICAgdGhpcy5yb2xlcyA9IHJlc3A7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0sDQogIH0sDQp9Ow0K"},{"version":3,"sources":["PermissMana.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PermissMana.vue","sourceRoot":"src/components/sys/basic","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"permissMana\">\r\n      <el-input size=\"small\" placeholder=\"请输入角色英文名\" v-model=\"role.name\">\r\n        <template size=\"small\" slot=\"prepend\">Role_</template>\r\n      </el-input>\r\n      <el-input\r\n        size=\"small\"\r\n        placeholder=\"请输入角色中文名\"\r\n        v-model=\"role.nameZh\"\r\n        @keydown.enter.native=\"doAddRole\"\r\n      >\r\n      </el-input>\r\n      <el-button size=\"small\" type=\"primary\" @click=\"doAddRole\"\r\n        >添加角色</el-button\r\n      >\r\n    </div>\r\n    <div class=\"permissManaMain\">\r\n      <el-collapse v-model=\"activeName\" accordion @change=\"change\">\r\n        <el-collapse-item\r\n          :title=\"r.nameZh\"\r\n          :name=\"r.id\"\r\n          v-for=\"(r, index) in roles\"\r\n          :key=\"index\"\r\n        >\r\n          <el-card class=\"box-card\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n              <span>可访问资源</span>\r\n              <el-button\r\n                style=\"float: right; padding: 3px 0; color: #ff0000\"\r\n                icon=\"el-icon-delete\"\r\n                type=\"text\"\r\n                @click=\"doDeleteRole(r)\"\r\n              ></el-button>\r\n            </div>\r\n            <div>\r\n              <el-tree\r\n                show-checkbox\r\n                ref=\"tree\"\r\n                :data=\"allMenus\"\r\n                :props=\"defaultProps\"\r\n                :default-checked-keys=\"selectedMenus\"\r\n                :key=\"index\"\r\n                node-key=\"id\"\r\n              ></el-tree>\r\n              <div style=\"display: flex; justify-content: flex-end\">\r\n                <el-button size=\"mini\" @click=\"cancelUpdate\"\r\n                  >取消修改</el-button\r\n                >\r\n                <el-button\r\n                  size=\"mini\"\r\n                  type=\"primary\"\r\n                  @click=\"doUpdate(r.id, index)\"\r\n                  >确认修改</el-button\r\n                >\r\n              </div>\r\n            </div>\r\n          </el-card>\r\n        </el-collapse-item>\r\n      </el-collapse>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"PermissMana\",\r\n  data() {\r\n    return {\r\n      role: {\r\n        name: \"\",\r\n        nameZh: \"\",\r\n      },\r\n      roles: [],\r\n      allMenus: [],\r\n      defaultProps: {\r\n        children: \"children\",\r\n        label: \"name\",\r\n      },\r\n      selectedMenus: [],\r\n      activeName: -1,\r\n    };\r\n  },\r\n  mounted() {\r\n    this.initRoles();\r\n  },\r\n  methods: {\r\n    doDeleteRole(role) {\r\n      this.$confirm(\"删除[\" + role.nameZh + \"]角色, 是否继续?\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      })\r\n        .then(() => {\r\n          this.deleteRequest(\"/system/basic/permission/delete\", {\r\n            id: role.id,\r\n          }).then((res) => {\r\n            if (res) {\r\n              this.initRoles();\r\n            }\r\n          });\r\n        })\r\n        .catch(() => {\r\n          this.$message({\r\n            type: \"info\",\r\n            message: \"已取消删除\",\r\n          });\r\n        });\r\n    },\r\n    doAddRole() {\r\n      if (this.role.name && this.role.nameZh) {\r\n        this.postRequest(\"/system/basic/permission/add\", this.role).then(\r\n          (resp) => {\r\n            if (resp) {\r\n              this.initRoles();\r\n              this.role.name = \"\";\r\n              this.role.nameZh = \"\";\r\n            }\r\n          }\r\n        );\r\n      } else {\r\n        this.$message.error(\"所有字段不能为空!\");\r\n      }\r\n    },\r\n    cancelUpdate() {\r\n      this.activeName = -1;\r\n    },\r\n    doUpdate(rid, index) {\r\n      let tree = this.$refs.tree[index];\r\n      let selectedKeys = tree.getCheckedKeys(true);\r\n      let url = \"/system/basic/permission/updatemenus/?rid=\" + rid;\r\n      selectedKeys.forEach((key) => {\r\n        url += \"&mids=\" + key;\r\n      });\r\n      this.putRequest(url).then((resp) => {\r\n        if (resp) {\r\n          this.initRoles();\r\n          this.activeName = -1;\r\n        }\r\n      });\r\n    },\r\n    change(rid) {\r\n      if (rid) {\r\n        this.selectedMenus = [];\r\n        this.initAllMenus();\r\n        this.initSelectedMenus(rid);\r\n      }\r\n    },\r\n    initSelectedMenus(rid) {\r\n      let url = \"/system/basic/permission/mid/?rid=\" + rid;\r\n      this.getRequest(url).then((resp) => {\r\n        console.log(resp);\r\n        this.selectedMenus = resp;\r\n      });\r\n    },\r\n    initAllMenus() {\r\n      this.getRequest(\"/system/basic/permission/menus\").then((resp) => {\r\n        if (resp) {\r\n          this.allMenus = resp;\r\n        }\r\n      });\r\n    },\r\n    initRoles() {\r\n      this.getRequest(\"/system/basic/permission/list\").then((resp) => {\r\n        if (resp) {\r\n          this.roles = resp;\r\n        }\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.permissMana {\r\n  display: flex;\r\n  justify-content: flex-start;\r\n}\r\n.permissMana .el-input {\r\n  width: 300px;\r\n  margin-right: 6px;\r\n}\r\n.permissManaMain {\r\n  margin-top: 10px;\r\n  width: 700px;\r\n}\r\n</style>"]}]}